## **📌 ما هو الـ Caching؟**

التخزين المؤقت (Caching) هو **تقنية تُستخدم لتخزين البيانات مؤقتًا في مكان قريب من المستخدم** (مثل المتصفح أو السيرفر) **لتسريع تحميل الصفحات وتقليل الضغط على الخادم**.

🔹 **الفكرة الأساسية:** بدلاً من إعادة تحميل نفس الموارد في كل مرة، يتم حفظ البيانات محليًا، مما يجعل تحميل الصفحة أسرع في المستقبل.

---

## **🔹 أنواع الـ Caching في تطوير الويب**

### **1️⃣ Caching على مستوى المتصفح (Browser Caching)**

📌 **يُخزن المتصفح بعض الملفات مثل الصور، الـ CSS، وملفات JavaScript، بحيث لا يحتاج إلى تنزيلها مجددًا عند زيارة نفس الموقع.**

🔹 **كيف يتحكم المطور في تخزين المتصفح؟**  
✅ عبر **هيدر HTTP** الذي يحدد مدة التخزين المؤقت.  
✅ باستخدام **Cache-Control و Expires**.

📌 **مثال في PHP:**

```php
header("Cache-Control: max-age=3600, must-revalidate");
header("Expires: Wed, 21 Oct 2025 07:28:00 GMT");
```

📌 **معنى ذلك:**  
🔹 الملفات ستُحفظ في المتصفح لمدة ساعة (`3600` ثانية).  
🔹 بعدها يجب على المتصفح التحقق من وجود تحديثات.

---

### **2️⃣ Caching على مستوى السيرفر (Server Caching)**

📌 **يتم تخزين بيانات الصفحات على السيرفر لتقليل وقت تنفيذ الـ PHP وتقليل الضغط على قاعدة البيانات.**

🔹 **أنواع Server Caching:**  
✅ **Opcode Cache** → يقوم بحفظ الأكواد الـ PHP بعد تفسيرها لأول مرة، مثل `OPcache`.  
✅ **Page Cache** → يُخزن الصفحات الجاهزة بدلاً من تنفيذ الكود في كل مرة، مثل `Varnish Cache`.  
✅ **Object Cache** → يُخزن كائنات قاعدة البيانات لتقليل الاستعلامات، مثل `Redis` أو `Memcached`.

📌 **تفعيل OPcache في PHP:** في ملف `php.ini`:

```ini
opcache.enable=1
opcache.memory_consumption=128
opcache.max_accelerated_files=10000
```

✅ **هذا يجعل أكواد PHP تُخزن في الذاكرة لتُنفذ بشكل أسرع!** 🚀

---

### **3️⃣ Caching على مستوى CDN (شبكة توزيع المحتوى)**

📌 **يتم حفظ نسخ من الموقع في سيرفرات حول العالم لتقليل وقت الاستجابة للزوار البعيدين جغرافيًا.**

✅ أمثلة:  
🔹 **Cloudflare**  
🔹 **Amazon CloudFront**  
🔹 **Google Cloud CDN**

📌 **كيف يعمل؟**  
1️⃣ يزور المستخدم الموقع → الطلب يُرسل إلى أقرب سيرفر CDN.  
2️⃣ إذا كان هناك نسخة مخزنة، يتم عرضها فورًا دون طلبها من السيرفر الرئيسي.  
3️⃣ إذا لم تكن مخزنة، يتم جلبها من السيرفر الأصلي وحفظها للطلبات المستقبلية.

---

## **🔹 كيفية التحكم في الـ Caching؟**

📌 **عبر HTTP Headers مثل `Cache-Control` و `Expires` و `ETag`.**

### **1️⃣ `Cache-Control`** (التحكم في التخزين المؤقت)

✅ يحدد كيفية تخزين الموارد في المتصفح أو الـ CDN.

📌 **مثال:**

```php
header("Cache-Control: max-age=3600, public");
```

🔹 **`max-age=3600`** → يخزن الصفحة لمدة ساعة (3600 ثانية).  
🔹 **`public`** → يُسمح لأي كاش سيرفر أو متصفح بتخزين النسخة.

🚀 **إذا كنت لا تريد التخزين المؤقت، استخدم:**

```php
header("Cache-Control: no-cache, no-store, must-revalidate");
```

🔹 يمنع المتصفح من تخزين الصفحة أبدًا!

---

### **2️⃣ `Expires`** (تحديد تاريخ انتهاء الكاش)

✅ يحدد تاريخ انتهاء صلاحية الكاش.

📌 **مثال:**

```php
header("Expires: Fri, 01 Jan 2025 12:00:00 GMT");
```

🔹 الصفحة ستكون صالحة للكاش حتى 1 يناير 2025.

---

### **3️⃣ `ETag`** (تحديد نسخة المحتوى)

✅ يساعد المتصفح في معرفة إذا تم تغيير الملف أم لا.

📌 **مثال:**

```php
header("ETag: \"123456\"");
```

🔹 إذا حاول المتصفح طلب نفس الملف وكان لديه نفس `ETag`، فإنه يستخدم النسخة المخزنة بدلًا من تنزيلها مجددًا.

---

## **📌 متى تستخدم الـ Caching؟**

✅ عندما تريد تسريع تحميل الصفحات وتقليل استهلاك الباندويث.  
✅ إذا كان موقعك يحتوي على موارد ثابتة مثل الصور و CSS و JavaScript.  
✅ عند استخدام API يحتاج إلى استجابات سريعة.  
✅ عند استهداف جمهور عالمي، حيث يكون CDN مفيدًا جدًا.

❌ **لا تستخدم الكاش عندما:**

- تحتاج إلى عرض بيانات متغيرة باستمرار (مثل الأخبار أو البيانات الحية).
- تريد إظهار التحديثات للمستخدم فورًا دون تأخير.

---

## **🚀 خلاصة**

✅ التخزين المؤقت يساعد في **تقليل استهلاك الموارد وتسريع تحميل الصفحات**.  
✅ يوجد **Caching على مستوى المتصفح، السيرفر، والـ CDN**.  
✅ يمكن التحكم فيه باستخدام **HTTP Headers** مثل `Cache-Control` و `Expires`.  
✅ بعض الحالات تحتاج إلى تعطيل الكاش لضمان عرض البيانات الحديثة دائمًا.

🔹 **هل لديك أسئلة؟** 

---
### 📌 **ملاحظة: التخزين المؤقت (Caching) والمخاطر الأمنية**

#### **ما هو التخزين المؤقت؟**

التخزين المؤقت هو تقنية تُستخدم لتخزين نسخ مؤقتة من البيانات بهدف تحسين أداء المواقع. يساعد في تحميل الصفحات بشكل أسرع من خلال تقديم البيانات المخزنة (المخبأة) بدلاً من جلبها من الخادم في كل مرة.

#### **أنواع التخزين المؤقت:**

1. **التخزين المؤقت على الجانب العميل (Client-side Caching):** يتم حفظ بعض البيانات على جهاز المستخدم بواسطة المتصفح، مما يقلل وقت التحميل عند زيارة الموقع مرة أخرى.
2. **التخزين المؤقت على الجانب الخادم (Server-side Caching):** يقوم الخادم بحفظ استجابات بعض الطلبات وإعادة استخدامها عند استقبال طلبات مماثلة، مما يقلل الحمل على الخادم ويحسن سرعة الموقع.

#### **دور الـ CDNs (شبكات توصيل المحتوى)**

شبكات توصيل المحتوى (CDN) مثل Cloudflare وAkamai تقوم بتخزين نسخ من محتوى الموقع على خوادم موزعة عالميًا، مما يساعد في:  
✅ تحسين سرعة تحميل المواقع  
✅ تقليل الضغط على الخادم الرئيسي  
✅ تعزيز الحماية من الهجمات مثل DDoS

#### **كيف يعمل التخزين المؤقت؟**

عند تلقي طلب، يقوم النظام بالتحقق مما إذا كان هناك استجابة سابقة محفوظة لنفس الطلب (باستخدام **مفاتيح التخزين المؤقت - Cache Keys**). إذا وُجد تطابق، يتم إرسال الاستجابة المخزنة، وإذا لم يوجد، يتم تمرير الطلب إلى الخادم للحصول على استجابة جديدة.

#### **المخاطر الأمنية المرتبطة بالتخزين المؤقت:**

⚠️ **التخزين المؤقت للبيانات الحساسة:** قد يؤدي تخزين ردود تحتوي على معلومات حساسة إلى تسريب بيانات المستخدمين.  
⚠️ **تسميم التخزين المؤقت (Cache Poisoning):** يمكن للمهاجم إدخال محتوى ضار في ذاكرة التخزين المؤقت بحيث يُعرض للمستخدمين الآخرين.  
⚠️ **خداع التخزين المؤقت (Cache Deception):** يستغل بعض المهاجمين إعدادات التخزين المؤقت لاسترجاع بيانات حساسة أو تنفيذ هجمات أخرى.

#### **كيف تتجنب مخاطر التخزين المؤقت؟**

✔️ استخدام رؤوس HTTP المناسبة مثل `Cache-Control` و `Pragma` لمنع تخزين البيانات الحساسة.  
✔️ التأكد من أن بيانات المصادقة والتفاصيل الخاصة بالمستخدمين لا يتم تخزينها مؤقتًا.  
✔️ تهيئة WAFs (جدران الحماية لتطبيقات الويب) بشكل صحيح لمنع استغلال نقاط الضعف المتعلقة بالتخزين المؤقت.

هذه الملاحظات توفر مقدمة أساسية لفهم التخزين المؤقت وكيفية التعامل مع مخاطره الأمنية عند اختبار التطبيقات والمواقع. 🚀